<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2025å¤åˆå®¿ å®Ÿç¸¾è§£é™¤</title>
  <style>
    :root {
      --bg: #0e0f10;
      --panel: #15191e;
      --border: #2b3139;
      --text: #dfe7ef;
      --muted: #8d99a6;
      --btn: #1e242b;
      --btn-hover: #28313a;
      --accent: #4caf50;
      --accent-glow: #b3ffb8;
      --gold: #f4c542;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1000px 600px at 20% -10%, #1b2027, var(--bg));
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, sans-serif;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .app { width: min(1100px, 96vw); }
    header {
      display:flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    h1 {
      font-size: clamp(18px, 2.3vw, 24px);
      margin: 0;
      letter-spacing: .02em;
    }
    .controls {
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    .control, button, select, input[type="number"] {
      background: var(--btn);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 12px;
      font: inherit;
      transition: transform .02s ease, background .2s ease, border-color .2s ease;
      outline: none;
    }
    button:hover, select:hover, input[type="number"]:hover { background: var(--btn-hover); }
    button:active { transform: translateY(1px); }
    .grid {
      background: linear-gradient(180deg, #13171c, var(--panel));
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      position: relative;
    }
    .cells { display: grid; gap: 12px; }
    .cell { position: relative; }
    .cell button {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 14px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      background: #0f1419;
      border: 1px solid #212932;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      min-width: 44px;
      min-height: 44px;
    }
    .cell button .label {
      position: absolute;
      left: 10px;
      bottom: 8px;
      right: 10px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.2;
    }
    .cell button .badge {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #1b222a;
      border:1px solid #2a313a;
      color: var(--muted);
    }
    .cell button.lit {
      border-color: rgba(76, 175, 80, .7);
      box-shadow: 0 0 0 1px rgba(76, 175, 80, .35),
                  0 4px 22px 0 rgba(76, 175, 80, .25),
                  inset 0 0 18px rgba(76, 175, 80, .25);
      background: radial-gradient(120px 120px at 30% 20%, rgba(76,175,80,.20), transparent), #0f1419;
    }
    .cell button.lit img,
.cell button.lit .cell-text {
  filter: brightness(1.3) drop-shadow(0 0 10px rgba(76, 255, 80, 0.8));
  transition: filter 0.3s ease;
}

.cell button.legendary.lit {
  box-shadow: 0 0 0 1px rgba(244,197,66,.45),
              0 6px 26px 0 rgba(244,197,66,.35),
              inset 0 0 22px rgba(244,197,66,.3);
  background: radial-gradient(120px 120px at 30% 20%, rgba(244,197,66,.22), transparent), #0f1419;
}

.cell button.legendary.lit img,
.cell button.legendary.lit .cell-text {
  filter: brightness(1.3) drop-shadow(0 0 10px rgba(255, 255, 120, 0.9));
}

    .cell button.lit::after {
      content:"";
      position:absolute;
      inset:-4px;
      border-radius: 16px;
      pointer-events: none;
      box-shadow: 0 0 22px 8px rgba(179,255,184,.12);
      animation: pulse 1.6s ease-in-out infinite;
    }
    @keyframes pulse {
      0%{ opacity:.45 }
      50%{ opacity:.1 }
      100%{ opacity:.45 }
    }
    .cell button.legendary { border-color: rgba(244,197,66,.7); }
    .cell button.legendary.lit {
      box-shadow: 0 0 0 1px rgba(244,197,66,.45),
                  0 6px 26px 0 rgba(244,197,66,.35),
                  inset 0 0 22px rgba(244,197,66,.3);
      background: radial-gradient(120px 120px at 30% 20%, rgba(244,197,66,.22), transparent), #0f1419;
    }
    .footer {
      display:flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      color: var(--muted);
      font-size: 13px;
    }
    .count { font-variant-numeric: tabular-nums; }

    /* ğŸ“± ã‚¹ãƒãƒ›ç”¨èª¿æ•´ */
    @media (max-width: 600px) {
      body { padding: 12px; }
      header { flex-direction: column; align-items: flex-start; gap: 8px; }
      .controls { width: 100%; justify-content: flex-start; }
      .cell button .label { font-size: 10px; }
      .cell button .badge { font-size: 9px; padding: 2px 6px; }
      h1 { font-size: 16px; }
    }

    .cell {
      position: relative;
      width: 100%;
      aspect-ratio: 1/1;
      overflow: hidden;
      border-radius: 8px;
    }
    .cell img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .cell-text {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      font-weight: bold;
      text-align: center;
      padding: 4px 0;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>2025å¤åˆå®¿ å®Ÿç¸¾è§£é™¤</h1>
      <div class="controls">
        <label class="control">
          ã‚µã‚¤ã‚ºï¼š
          <input id="rows" type="number" min="1" max="12" value="4" style="width:4.5em; margin-left:.5em;">
          Ã—
          <input id="cols" type="number" min="1" max="12" value="5" style="width:4.5em; margin-left:.5em;">
        </label>
        <select id="preset">
          <option value="tenkenmin">å¤©ç ”æ°‘ã¨ã®äº¤æµ</option>
          <option value="stargazing-specialist">è¦³æ¸¬ã®ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆ</option>
          <option value="mvp">ï¼­ï¼¶ï¼°(ã‚‚ã£ã¨ã‚‚ ãƒ´ã‚¡ã‚’ç››ã‚Šä¸Šã’ãŸ ã±ãƒ¼ãã‚“)</option>
          <option value="top-adventure-explorer">ä¸€æµå†’é™ºå®¶</option>
        </select>
        <button id="apply">ä½œæˆ / å¤‰æ›´</button>
        <button id="reset">ã™ã¹ã¦æ¶ˆç¯</button>
        <button id="save">ä¿å­˜</button>
        <button id="load">èª­è¾¼</button>
      </div>
    </header>

    <section class="grid">
      <div id="cells" class="cells"></div>
      <div class="footer">
        <div class="count"><span id="litCount">0</span> / <span id="totalCount">0</span> è§£æ”¾</div>
        <div class="hint">ã‚»ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ç‚¹ç¯/æ¶ˆç¯</div>
      </div>
    </section>
  </div>

  <script>
    const cellsEl = document.getElementById('cells');
    const rowsEl = document.getElementById('rows');
    const colsEl = document.getElementById('cols');
    const applyBtn = document.getElementById('apply');
    const resetBtn = document.getElementById('reset');
    const saveBtn = document.getElementById('save');
    const loadBtn = document.getElementById('load');
    const presetEl = document.getElementById('preset');
    const litCountEl = document.getElementById('litCount');
    const totalCountEl = document.getElementById('totalCount');

    const PRESETS = {
      "tenkenmin": {
        size:[13,4],
        labels:[
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//10
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//20
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//30
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//40
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//45
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//50
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"å…¨å“¡é”æˆ"},
          null,
        ],
        legendary:[50]
      },
      "stargazing-specialist": {
        size:[7,3],
        labels:[
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st001.jpg",text:"æœ›é é¡çµ„ã¿ç«‹ã¦ã«æºã‚ã‚‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st002.jpg",text:"ç·è¦³ã•ã‚“ã‚’å¤§ããªå£°ã§å‘¼ã¶"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st003.jpg",text:"ã‚¦ã‚©ãƒƒãƒãƒ³ã‚°ã‚’é–‹ã"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st004.jpg",text:"åŒå®šã‚’ãŠé¡˜ã„ã™ã‚‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st005.jpg",text:"ä¸€æ™©ä¸­èµ·ãã¦ãŠã"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st006.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st007.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st008.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st009.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0010.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0011.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0012.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0013.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0014.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0015.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0016.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0017.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0018.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0019.jpg",text:"M"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0020.jpg",text:"M"},//20
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st0021.jpg",text:"å®Ÿç¸¾é”æˆ"},
        ],
        legendary:[20]
      },
      "mvp": {
        size:[4,3],
        labels:[
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv001.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯å‚åŠ "},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv002.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯å„ªå‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv003.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯MVP"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv004.jpg",text:"é‹å‹•å‚åŠ "},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv005.jpg",text:"é‹å‹•å„ªå‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv006.jpg",text:"é‹å‹•MVP"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv007.jpg",text:"ã‚¯ã‚¤ã‚ºå‚åŠ "},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv008.jpg",text:"ã‚¯ã‚¤ã‚ºå„ªå‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv009.jpg",text:"ã‚¯ã‚¤ã‚ºMVP"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv0010.jpg",text:"å®Ÿç¸¾é”æˆ"},//10
          null,
          null,
        ],
        legendary:[9]
      },
      "top-adventure-explorer": {
        size:[4,3],
        labels:[
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad002.jpg",text:"å¤§ç¥å±±ç¥ç¤¾å‚æ‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad003.jpg",text:"ã‚¹ã‚­ãƒ¼ã‚¸ãƒ£ãƒ³ãƒ—å°"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad004.jpg",text:"ã‚²ãƒ¬ãƒ³ãƒ‡ãƒªãƒ•ãƒˆä¹—ã‚Šå ´"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad005.jpg",text:"ãƒ¢ãƒ³ãƒ™ãƒ«å¤§å±±åº—"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad006.jpg",text:"å¤§å±±è‡ªç„¶é¤¨"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad007.jpg",text:"è¶³æ¹¯"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad008.jpg",text:"é³¥å–ç ‚ä¸˜ã®æµ·"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad009.jpg",text:"é³¥å–ç ‚ä¸˜ã®é¦¬ã®èƒŒ"},
          //ä¸‹æ®µã«å·¦2ãƒã‚¹ã‚’ç”»åƒã€å³1ãƒã‚¹ã‚’ç©ºç™½ã®ã‚»ãƒ«
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad0010.jpg",text:"é³¥å–ç ‚ä¸˜ãƒ¢ãƒ‹ãƒ¥ãƒ¡ãƒ³ãƒˆ"},//10
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad0011.jpg",text:"å®Ÿç¸¾é”æˆ"},
          null,
        ],
        legendary:[10]
      }
    };
    
    const totalCells = PRESETS.tenkenmin.labels.length; // 49
    const cols = 5;
    const rows = Math.ceil(totalCells / cols); // 10è¡Œ
    PRESETS.tenkenmin.size = [rows, cols];
    
    let R = 4, C = 5;
    let labels = [];
    let legendary = new Set();

    function buildGrid(r=R, c=C, givenLabels=null) {
  R = r;
  C = c;
  cellsEl.style.gridTemplateColumns = `repeat(${C}, minmax(50px, 1fr))`;

  if (givenLabels && givenLabels.length) {
    labels = givenLabels;
  } else {
    labels = Array.from({length: r*c}, (_,i)=>`å®Ÿç¸¾ ${i+1}`);
  }
  
  cellsEl.innerHTML = '';
  let effectiveCount = 0;  // âœ… å®Ÿéš›ã«ã‚«ã‚¦ãƒ³ãƒˆå¯¾è±¡ã«ãªã‚‹ãƒã‚¹æ•°

  for (let i=0; i<r*c; i++) {
    const label = labels[i] || null;
    const cell = document.createElement('div');
    cell.className = 'cell';
  
    if (label === null) {
      // ç©ºã‚»ãƒ«ã¯ div ã®ã¿ã€ã‚«ã‚¦ãƒ³ãƒˆã—ãªã„
      cellsEl.appendChild(cell);
      continue;
    }

    effectiveCount++; // âœ… å®Ÿéš›ã®æœ‰åŠ¹ãƒã‚¹ã‚’ã‚«ã‚¦ãƒ³ãƒˆ

    const btn = document.createElement('button');
    btn.type = 'button';
    btn.dataset.idx = i;
    btn.setAttribute('aria-pressed', 'false');
    if (legendary.has(i)) btn.classList.add('legendary');

    let imgSrc = "images/placeholder.png";
    let textLabel = "";

    if (typeof label === "object") {
      imgSrc = label.img || imgSrc;
      textLabel = label.text || "";
    } else if (typeof label === "string") {
      if (label.match(/\.(jpg|png|gif)$/)) imgSrc = label;
      else textLabel = label;
    }

    btn.innerHTML =`
      <span class="badge">#${i+1}</span>
      <img src="${imgSrc}" alt="">
      <span class="cell-text">${textLabel}</span>`;

    btn.addEventListener('click', () => toggle(btn));
    cell.appendChild(btn);
    cellsEl.appendChild(cell);
  }

  updateCounts();
  totalCountEl.textContent = effectiveCount;  // âœ… æœ‰åŠ¹ã‚»ãƒ«ã ã‘è¡¨ç¤º
}

    function toggle(btn){
  const idx = +btn.dataset.idx;
  // âœ… ç‰¹æ®Šå‡¦ç†ãŒå¿…è¦ãªãƒ—ãƒªã‚»ãƒƒãƒˆ
  const specialPresets = ["tenkenmin", "stargazing-specialist", "top-adventure-explorer"];

  // æœ€å¾Œã®ãƒã‚¹ã¯ã‚¯ãƒªãƒƒã‚¯ã§ç‚¹ç¯ã•ã›ãªã„
  if (specialPresets.includes(presetEl.value) && idx === labels.length - 1) {
    return;
  }

  const lit = btn.classList.toggle('lit');
  btn.setAttribute('aria-pressed', String(lit));
  updateCounts();
}

function updateCounts(){
  const litButtons = cellsEl.querySelectorAll('button.lit');
  litCountEl.textContent = litButtons.length;

  // âœ… ç‰¹æ®Šå‡¦ç†ãŒå¿…è¦ãªãƒ—ãƒªã‚»ãƒƒãƒˆ
  const specialPresets = ["tenkenmin", "stargazing-specialist", "top-adventure-explorer"];

  if (specialPresets.includes(presetEl.value)) {
    const allButtons = cellsEl.querySelectorAll('button[data-idx]');
    
    // â­ null ã‚’é™¤ã„ãŸæœ€å¾Œã®æœ‰åŠ¹ã‚»ãƒ«ã‚’å¯¾è±¡ã«ã™ã‚‹
    let lastIdx = labels.length - 1;
    while (lastIdx >= 0 && labels[lastIdx] === null) {
      lastIdx--;
    }

    const lastBtn = cellsEl.querySelector(`button[data-idx="${lastIdx}"]`);
    if (lastBtn) {
      const otherBtns = Array.from(allButtons).filter(b => +b.dataset.idx !== lastIdx);
      const allLit = otherBtns.every(b => b.classList.contains('lit'));
      if (allLit) {
        lastBtn.classList.add('lit');
        lastBtn.setAttribute('aria-pressed','true');
      } else {
        lastBtn.classList.remove('lit');
        lastBtn.setAttribute('aria-pressed','false');
      }
    }
  }
}
    
// âœ… MVP å°‚ç”¨å‡¦ç†
  if (presetEl.value === "mvp") {
    const lastIdx = 9; // å®Ÿç¸¾é”æˆã‚»ãƒ«ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    const lastBtn = cellsEl.querySelector(`button[data-idx="${lastIdx}"]`);
    if (lastBtn) {
      // å‚åŠ ç³»ï¼ˆã™ã¹ã¦ç‚¹ç¯ï¼‰
      const participate = [0, 3, 6].every(i =>
        cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
      );

      // å„ªå‹ç³»ï¼ˆå°‘ãªãã¨ã‚‚1ã¤ï¼‰
      const champion = [1, 4, 7].some(i =>
        cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
      );

      // MVPç³»ï¼ˆå°‘ãªãã¨ã‚‚1ã¤ï¼‰
      const mvp = [2, 5, 8].some(i =>
        cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
      );

      if (participate && champion && mvp) {
        lastBtn.classList.add('lit');
        lastBtn.setAttribute('aria-pressed','true');
      } else {
        lastBtn.classList.remove('lit');
        lastBtn.setAttribute('aria-pressed','false');
      }
    }
  }
}
    
    function applySizeFromInputs(){
      const r = clamp(parseInt(rowsEl.value||'4',10), 1, 12);
      const c = clamp(parseInt(colsEl.value||'5',10), 1, 12);
      buildGrid(r, c, labels);
    }

    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

    function getStorageKey() {
      const preset = presetEl.value || "custom";
      return "mc_like_achievements_" + preset;
    }

    function save() {
      const litIndices = Array.from(cellsEl.querySelectorAll('button.lit')).map(b => +b.dataset.idx);
      const data = { R, C, labels, legendary:[...legendary], lit: litIndices };
      localStorage.setItem(getStorageKey(), JSON.stringify(data));
      alert(`ä¿å­˜ã—ã¾ã—ãŸï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆ: ${presetEl.value || "custom"}ï¼‰`);
    }

    function load() {
      const raw = localStorage.getItem(getStorageKey());
      if (!raw) {
        alert('ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
        return;
      }
      try {
        const data = JSON.parse(raw);
        R = data.R;
        C = data.C;
        labels = data.labels || [];
        legendary = new Set(data.legendary || []);
        rowsEl.value = R;
        colsEl.value = C;
        buildGrid(R, C, labels);
        for (const idx of data.lit || []) {
          const btn = cellsEl.querySelector(`button[data-idx="${idx}"]`);
          if (btn) {
            btn.classList.add('lit');
            btn.setAttribute('aria-pressed','true');
          }
        }
        updateCounts();
        alert(`èª­è¾¼å®Œäº†ï¼ˆãƒ—ãƒªã‚»ãƒƒãƒˆ: ${presetEl.value || "custom"}ï¼‰`);
      } catch(e) {
        alert('èª­è¾¼ã«å¤±æ•—ã—ã¾ã—ãŸ');
      }
    }

    function resetAll(){
      cellsEl.querySelectorAll('button.lit').forEach(b=>{
        b.classList.remove('lit');
        b.setAttribute('aria-pressed','false');
      });
      updateCounts();
    }

    function usePreset(name){
      const p = PRESETS[name];
      if (!p) return;
      legendary = new Set(p.legendary || []);
      rowsEl.value = p.size[0];
      colsEl.value = p.size[1];
      buildGrid(p.size[0], p.size[1], p.labels);
    }

    applyBtn.addEventListener('click', applySizeFromInputs);
    resetBtn.addEventListener('click', resetAll);
    saveBtn.addEventListener('click', save);
    loadBtn.addEventListener('click', load);
    presetEl.addEventListener('change', (e)=>{ if (e.target.value) usePreset(e.target.value); });

    // ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã§é¸ã°ã‚Œã¦ã„ã‚‹ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’åˆæœŸè¡¨ç¤º
    usePreset(presetEl.value);
  </script>
</body>
</html>
