<!doctype html>
<html lang="ja">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>2025å¤åˆå®¿ å®Ÿç¸¾è§£é™¤</title>
Â  <style>
Â  Â  :root {
Â  Â  Â  --bg: #0e0f10;
Â  Â  Â  --panel: #15191e;
Â  Â  Â  --border: #2b3139;
Â  Â  Â  --text: #dfe7ef;
Â  Â  Â  --muted: #8d99a6;
Â  Â  Â  --btn: #1e242b;
Â  Â  Â  --btn-hover: #28313a;
Â  Â  Â  --accent: #4caf50;
Â  Â  Â  --accent-glow: #b3ffb8;
Â  Â  Â  --gold: #f4c542;
Â  Â  Â  --blue-glow: #87ceeb; /* âœ… è¿½åŠ : é’è‰²ã®ã‚°ãƒ­ãƒ¼ */
Â  Â  }
Â  Â  * { box-sizing: border-box; }
Â  Â  html, body { height: 100%; }
Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  background: radial-gradient(1000px 600px at 20% -10%, #1b2027, var(--bg));
Â  Â  Â  color: var(--text);
Â  Â  Â  font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, sans-serif;
Â  Â  Â  display: grid;
Â  Â  Â  place-items: center;
Â  Â  Â  padding: 24px;
Â  Â  }
Â  Â  .app { width: min(1100px, 96vw); }
Â  Â  header {
Â  Â  Â  display:flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  gap: 12px;
Â  Â  Â  margin-bottom: 14px;
Â  Â  Â  flex-wrap: wrap;
Â  Â  }
Â  Â  h1 {
Â  Â  Â  font-size: clamp(18px, 2.3vw, 24px);
Â  Â  Â  margin: 0;
Â  Â  Â  letter-spacing: .02em;
Â  Â  }
Â  Â  .controls {
Â  Â  Â  display:flex;
Â  Â  Â  flex-wrap: wrap;
Â  Â  Â  gap: 8px;
Â  Â  Â  align-items: center;
Â  Â  }
Â  Â  .control, button, select, input[type="number"] {
Â  Â  Â  background: var(--btn);
Â  Â  Â  color: var(--text);
Â  Â  Â  border: 1px solid var(--border);
Â  Â  Â  border-radius: 10px;
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  font: inherit;
Â  Â  Â  transition: transform .02s ease, background .2s ease, border-color .2s ease;
Â  Â  Â  outline: none;
Â  Â  }
Â  Â  button:hover, select:hover, input[type="number"]:hover { background: var(--btn-hover); }
Â  Â  button:active { transform: translateY(1px); }
Â  Â  .grid {
Â  Â  Â  background: linear-gradient(180deg, #13171c, var(--panel));
Â  Â  Â  border: 1px solid var(--border);
Â  Â  Â  border-radius: 16px;
Â  Â  Â  padding: 16px;
Â  Â  Â  position: relative;
Â  Â  }
Â  Â  .cells { display: grid; gap: 12px; }
Â  Â  .cell { position: relative; }
Â  Â  .cell button {
Â  Â  Â  width: 100%;
Â  Â  Â  aspect-ratio: 1 / 1;
Â  Â  Â  border-radius: 14px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  position: relative;
Â  Â  Â  overflow: hidden;
Â  Â  Â  background: #0f1419;
Â  Â  Â  border: 1px solid #212932;
Â  Â  Â  box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
Â  Â  Â  min-width: 44px;
Â  Â  Â  min-height: 44px;
Â  Â  }
Â  Â  .cell button .label {
Â  Â  Â  position: absolute;
Â  Â  Â  left: 10px;
Â  Â  Â  bottom: 8px;
Â  Â  Â  right: 10px;
Â  Â  Â  font-size: 12px;
Â  Â  Â  color: var(--muted);
Â  Â  Â  line-height: 1.2;
Â  Â  }
Â  Â  .cell button .badge {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 8px;
Â  Â  Â  right: 8px;
Â  Â  Â  font-size: 11px;
Â  Â  Â  padding: 4px 8px;
Â  Â  Â  border-radius: 999px;
Â  Â  Â  background: #1b222a;
Â  Â  Â  border:1px solid #2a313a;
Â  Â  Â  color: var(--muted);
Â  Â  }
Â  Â  .cell button.lit {
Â  Â  Â  border-color: rgba(76, 175, 80, .7);
Â  Â  Â  box-shadow: 0 0 0 1px rgba(76, 175, 80, .7),
Â  Â  Â  Â  Â  Â  Â  Â  Â  0 4px 22px 0 rgba(76, 175, 80, .25),
Â  Â  Â  Â  Â  Â  Â  Â  Â  inset 0 0 18px rgba(76, 175, 80, .25);
Â  Â  Â  background: radial-gradient(120px 120px at 30% 20%, rgba(76,175,80,.20), transparent), #0f1419;
Â  Â  }
Â  Â  .cell button.lit img,
.cell button.lit .cell-text {
Â  filter: brightness(1.3) drop-shadow(0 0 10px rgba(76, 255, 80, 0.8));
Â  transition: filter 0.3s ease;
}

.cell button.legendary.lit {
Â  box-shadow: 0 0 0 1px rgba(244,197,66,.45),
Â  Â  Â  Â  Â  Â  Â  0 6px 26px 0 rgba(244,197,66,.35),
Â  Â  Â  Â  Â  Â  Â  inset 0 0 22px rgba(244,197,66,.3);
Â  background: radial-gradient(120px 120px at 30% 20%, rgba(244,197,66,.22), transparent), #0f1419;
}

.cell button.legendary.lit img,
.cell button.legendary.lit .cell-text {
Â  filter: brightness(1.3) drop-shadow(0 0 10px rgba(255, 255, 120, 0.9));
}

Â  Â  .cell button.lit::after {
Â  Â  Â  content:"";
Â  Â  Â  position:absolute;
Â  Â  Â  inset:-4px;
Â  Â  Â  border-radius: 16px;
Â  Â  Â  pointer-events: none;
Â  Â  Â  box-shadow: 0 0 22px 8px rgba(179,255,184,.12);
Â  Â  Â  animation: pulse 1.6s ease-in-out infinite;
Â  Â  }
Â  Â  @keyframes pulse {
Â  Â  Â  0%{ opacity:.45 }
Â  Â  Â  50%{ opacity:.1 }
Â  Â  Â  100%{ opacity:.45 }
Â  Â  }
Â  Â  .cell button.legendary { border-color: rgba(244,197,66,.7); }
Â  Â  .cell button.legendary.lit {
Â  Â  Â  box-shadow: 0 0 0 1px rgba(244,197,66,.45),
Â  Â  Â  Â  Â  Â  Â  Â  Â  0 6px 26px 0 rgba(244,197,66,.35),
Â  Â  Â  Â  Â  Â  Â  Â  Â  inset 0 0 22px rgba(244,197,66,.3);
Â  Â  Â  background: radial-gradient(120px 120px at 30% 20%, rgba(244,197,66,.22), transparent), #0f1419;
Â  Â  }
Â  Â  .footer {
Â  Â  Â  display:flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  align-items: center;
Â  Â  Â  margin-top: 12px;
Â  Â  Â  color: var(--muted);
Â  Â  Â  font-size: 13px;
Â  Â  }
Â  Â  .count { font-variant-numeric: tabular-nums; }

Â  Â  /* ğŸ“± ã‚¹ãƒãƒ›ç”¨èª¿æ•´ */
Â  Â  @media (max-width: 600px) {
Â  Â  Â  body { padding: 12px; }
Â  Â  Â  header { flex-direction: column; align-items: flex-start; gap: 8px; }
Â  Â  Â  .controls { width: 100%; justify-content: flex-start; }
Â  Â  Â  .cell button .label { font-size: 10px; }
Â  Â  Â  .cell button .badge { font-size: 9px; padding: 2px 6px; }
Â  Â  Â  h1 { font-size: 16px; }

Â  Â  Â  .title-row {
Â  Â  Â  flex-direction: row;
Â  Â  Â  flex-wrap: wrap;
Â  Â  }
Â  Â  Â Â 
Â  Â  }

Â  Â  .cell {
Â  Â  Â  position: relative;
Â  Â  Â  width: 100%;
Â  Â  Â  aspect-ratio: 1/1;
Â  Â  Â  overflow: hidden;
Â  Â  Â  border-radius: 8px;
Â  Â  }
Â  Â  .cell img {
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100%;
Â  Â  Â  object-fit: cover;
Â  Â  Â  display: block;
Â  Â  }
Â  Â  .cell-text {
Â  Â  Â  position: absolute;
Â  Â  Â  bottom: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  background: rgba(0, 0, 0, 0.5);
Â  Â  Â  color: white;
Â  Â  Â  font-weight: bold;
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 4px 0;
Â  Â  Â  font-size: 12px;
Â  Â  }

Â  Â  .cell-text {
Â  Â  Â  position: absolute;
Â  Â  Â  bottom: 0;
Â  Â  Â  left: 0;
Â  Â  Â  width: 100%;
Â  Â  Â  background: rgba(0, 0, 0, 0.5);
Â  Â  Â  color: white;
Â  Â  Â  font-weight: bold;
Â  Â  Â  text-align: center;
Â  Â  Â  padding: 4px 0;
Â  Â  Â  font-size: 12px;
Â  Â  }

Â  Â  #rewardBtn, #progressRewardBtn {
Â  position: relative;
Â  border: 1px solid var(--accent);
Â  background: var(--accent);
Â  color: #fff;
Â  font-weight: bold;
Â  cursor: pointer;
Â  overflow: hidden;
Â  transition: transform 0.1s ease, box-shadow 0.3s ease;
Â  border-radius: 12px;
Â  box-shadow: 0 0 6px rgba(244,197,66,0.5), 0 0 18px rgba(244,197,66,0.4);
}

#rewardBtn::before, #progressRewardBtn::before {
Â  content: "";
Â  position: absolute;
Â  top: -50%;
Â  left: -50%;
Â  width: 200%;
Â  height: 200%;
Â  background: linear-gradient(45deg, rgba(255,255,255,0.3) 25%, rgba(255,255,255,0.0) 50%, rgba(255,255,255,0.3) 75%);
Â  transform: rotate(45deg) translateX(-100%);
Â  pointer-events: none;
Â  transition: transform 0.5s ease;
}

#rewardBtn:hover::before, #progressRewardBtn:hover::before {
Â  transform: rotate(45deg) translateX(100%);
}

#rewardBtn:hover, #progressRewardBtn:hover {
Â  box-shadow: 0 0 15px var(--accent-glow), 0 0 30px var(--accent-glow);
Â  transform: scale(1.05);
}
Â  Â Â 
#rewardBtn.disabled, #progressRewardBtn.disabled {
Â  cursor: default;
Â  opacity: 1;
Â  box-shadow: 0 0 15px rgba(244,197,66,0.7), 0 0 30px rgba(244,197,66,0.6);
}

Â  Â  #rewardBtn.disabled, #progressRewardBtn.disabled {
Â  cursor: default;
Â  opacity: 1;
Â  box-shadow: 0 0 15px rgba(244,197,66,0.7), 0 0 30px rgba(244,197,66,0.6);
}

/* h1 ã¨é€²æ—ãƒœã‚¿ãƒ³ã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹ */
.title-row {
Â  display: flex;
Â  align-items: center;
Â  gap: 12px; /* h1 ã¨ãƒœã‚¿ãƒ³ã®é–“ã®ä½™ç™½ */
}

/* é€²æ—ãƒœã‚¿ãƒ³ç¾¤ */
.progress-btns {
Â  display: flex;
Â  gap: 6px;
}

.progress-btns button {
Â  width: 32px;
Â  height: 32px;
Â  border-radius: 8px;
Â  background: #222;
Â  border: 1px solid #444;
Â  color: #aaa;
Â  font-weight: bold;
Â  pointer-events: none; /* æŠ¼ã›ãªã„ */
}

.progress-btns button.lit {
Â  background: #0f1419;
Â  border-color: rgba(76, 175, 80, .7);
Â  color: #fff;
Â  box-shadow: 0 0 0 1px rgba(76, 175, 80, .35),
Â  Â  Â  Â  Â  Â  Â  0 4px 12px rgba(76, 175, 80, .4),
Â  Â  Â  Â  Â  Â  Â  inset 0 0 18px rgba(76, 175, 80, .25);
}

/* âœ… é€²æ—ç‡è¡¨ç¤ºãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
#progressRateBtn {
Â  background: var(--btn);
Â  color: var(--text);
Â  border: 1px solid var(--border);
Â  border-radius: 10px;
Â  padding: 8px 12px;
Â  font: inherit;
Â  pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯ä¸å¯ */
Â  text-align: center;
Â  white-space: nowrap;
}

/* âœ… æ–°ã—ã„å ±é…¬ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
#progressRewardBtn {
Â  border-color: rgba(76, 175, 80, .7);
Â  box-shadow: 0 0 0 1px rgba(76, 175, 80, .7),
Â  Â  Â  Â  Â  Â  Â  0 4px 22px 0 rgba(76, 175, 80, .25),
Â  Â  Â  Â  Â  Â  Â  inset 0 0 18px rgba(76, 175, 80, .25);
Â  background: radial-gradient(120px 120px at 30% 20%, rgba(76,175,80,.20), transparent), #0f1419;
}

#progressRewardBtn.lit::after {
Â  content:"";
Â  position:absolute;
Â  inset:-4px;
Â  border-radius: 16px;
Â  pointer-events: none;
Â  box-shadow: 0 0 22px 8px rgba(179,255,184,.12);
Â  animation: pulse 1.6s ease-in-out infinite;
}

Â  </style>
</head>
<body>
Â  <div class="app">
Â  Â  <header>
Â  Â  Â  <div class="title-row">
Â  Â  Â  <h1>2025å¤åˆå®¿ å®Ÿç¸¾è§£é™¤</h1>
Â  Â  Â  <button id="progressRateBtn" disabled style="display:none;"></button>
Â  Â  Â  </div>
Â  Â  Â  <div class="controls">
Â  Â  Â  Â  <select id="preset">
Â  Â  Â  Â  Â  <option value="tenkenmin">å¤©ç ”æ°‘ã¨ã®äº¤æµ</option>
Â  Â  Â  Â  Â  <option value="stargazing-specialist">è¦³æ¸¬ã®ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆ</option>
Â  Â  Â  Â  Â  <option value="mvp">ï¼­ï¼¶ï¼°(ã‚‚ã£ã¨ã‚‚ ãƒ´ã‚¡ã‚’ç››ã‚Šä¸Šã’ãŸ ã±ãƒ¼ãã‚“)</option>
Â  Â  Â  Â  Â  <option value="top-adventure-explorer">ä¸€æµå†’é™ºå®¶</option>
Â  Â  Â  Â  Â  <option value="syaken-A">å†™ç ”ã®ã‚¨ãƒ¼ã‚¹</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <button id="reset">ã™ã¹ã¦æ¶ˆç¯</button>
Â  Â  Â  Â  <div id="progressBtns" class="progress-btns">
Â  Â  <button id="pb1" disabled>1</button>
Â  Â  <button id="pb2" disabled>2</button>
Â  Â  <button id="pb3" disabled>3</button>
Â  Â  <button id="pb4" disabled>4</button>
Â  Â  <button id="pb5" disabled>5</button>
Â  Â  Â  </div>
Â  Â  Â  Â  <button id="rewardBtn" style="display:none;" disabled>å ±é…¬ç²å¾—ï¼</button>
Â  Â  Â  Â  <button id="progressRewardBtn" style="display:none;" disabled>é€²æ—å ±é…¬ï¼</button>
Â  Â  Â  </div>
Â  Â  </header>

Â  Â  <section class="grid">
Â  Â  Â  <div id="cells" class="cells"></div>
Â  Â  Â  <div class="footer">
Â  Â  Â  Â  <div class="count"><span id="litCount">0</span> / <span id="totalCount">0</span> è§£æ”¾</div>
Â  Â  Â  Â  <div class="hint">ã‚»ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ç‚¹ç¯/æ¶ˆç¯</div>
Â  Â  Â  </div>
Â  Â  </section>
Â  </div>

Â  <script>
Â  Â  const cellsEl = document.getElementById('cells');
Â  Â  const resetBtn = document.getElementById('reset');
Â  Â  const presetEl = document.getElementById('preset');
Â  Â  const litCountEl = document.getElementById('litCount');
Â  Â  const totalCountEl = document.getElementById('totalCount');
Â  Â  const progressRateBtn = document.getElementById('progressRateBtn');
Â  Â  const progressRewardBtn = document.getElementById('progressRewardBtn');

Â  Â  const PRESETS = {
Â  Â  Â  "tenkenmin": {
Â  Â  Â  Â  size:[18,3],
Â  Â  Â  Â  labels:[
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//10
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//20
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//30
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//40
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//45
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//50
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"å…¨å“¡é”æˆ"},
Â  Â  Â  Â  Â  null,
Â  Â  Â  Â  Â  null,
Â  Â  Â  Â  Â  null,
Â  Â  Â  Â  ],
Â  Â  Â  Â  legendary:[50]
Â  Â  Â  },
Â  Â  Â  "stargazing-specialist": {
Â  Â  Â  Â  size:[7,3],
Â  Â  Â  Â  labels:[
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st001.jpg",text:"æœ›é é¡çµ„ã¿ç«‹ã¦ã«æºã‚ã‚‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st002.jpg",text:"ç·è¦³ã•ã‚“ã‚’å¤§ããªå£°ã§å‘¼ã¶"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st003.jpg",text:"ã‚¦ã‚©ãƒƒãƒãƒ³ã‚°ã‚’é–‹ã"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st004.jpg",text:"åŒå®šã‚’ãŠé¡˜ã„ã™ã‚‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st005.jpg",text:"ä¸€æ™©ä¸­èµ·ãã¦ãŠã"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st006.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st007.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st008.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st009.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st010.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st011.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st012.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st013.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st014.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st015.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st016.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st017.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st018.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st019.jpg",text:"M"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st020.jpg",text:"M"},//20
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st021.jpg",text:"å®Ÿç¸¾é”æˆ"},
Â  Â  Â  Â  ],
Â  Â  Â  Â  legendary:[20]
Â  Â  Â  },
Â  Â  Â  "mvp": {
Â  Â  Â  Â  size:[4,3],
Â  Â  Â  Â  labels:[
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv001.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯å‚åŠ "},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv002.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯å„ªå‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv003.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯MVP"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv004.jpg",text:"é‹å‹•å‚åŠ "},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv005.jpg",text:"é‹å‹•å„ªå‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv006.jpg",text:"é‹å‹•MVP"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv007.jpg",text:"ã‚¯ã‚¤ã‚ºå‚åŠ "},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv008.jpg",text:"ã‚¯ã‚¤ã‚ºå„ªå‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv009.jpg",text:"ã‚¯ã‚¤ã‚ºMVP"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv010.jpg",text:"å®Ÿç¸¾é”æˆ"},//10
Â  Â  Â  Â  Â  null,
Â  Â  Â  Â  Â  null,
Â  Â  Â  Â  ],
Â  Â  Â  Â  legendary:[9]
Â  Â  Â  },
Â  Â  Â  "top-adventure-explorer": {
Â  Â  Â  Â  size:[4,3],
Â  Â  Â  Â  labels:[
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad002.jpg",text:"å¤§ç¥å±±ç¥ç¤¾å‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad003.jpg",text:"ã‚¹ã‚­ãƒ¼ã‚¸ãƒ£ãƒ³ãƒ—å°"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad004.jpg",text:"ã‚²ãƒ¬ãƒ³ãƒ‡ãƒªãƒ•ãƒˆä¹—ã‚Šå ´"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad005.jpg",text:"ãƒ¢ãƒ³ãƒ™ãƒ«å¤§å±±åº—"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad006.jpg",text:"å¤§å±±è‡ªç„¶é¤¨"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad007.jpg",text:"è¶³æ¹¯"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad008.jpg",text:"é³¥å–ç ‚ä¸˜ã®æµ·"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad009.jpg",text:"é³¥å–ç ‚ä¸˜ã®é¦¬ã®èƒŒ"},
Â  Â  Â  Â  Â  //ä¸‹æ®µã«å·¦2ãƒã‚¹ã‚’ç”»åƒã€å³1ãƒã‚¹ã‚’ç©ºç™½ã®ã‚»ãƒ«
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad010.jpg",text:"é³¥å–ç ‚ä¸˜ãƒ¢ãƒ‹ãƒ¥ãƒ¡ãƒ³ãƒˆ"},//10
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad011.jpg",text:"å®Ÿç¸¾é”æˆ"},
Â  Â  Â  Â  Â  null,
Â  Â  Â  Â  ],
Â  Â  Â  Â  legendary:[10]
Â  Â  Â  },
Â  Â  Â  "syaken-A": {
Â  Â  Â  Â  size:[4,3],
Â  Â  Â  Â  labels:[
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
Â  Â  Â  Â  Â  {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"å®Ÿç¸¾é”æˆ"},
Â  Â  Â  Â  Â  null,
Â  Â  Â  ],
Â  Â  Â  legendary:[10]
Â  Â  },

Â  Â  };
Â  Â Â 
Â  Â  let R = 4, C = 5;
Â  Â  let labels = [];
Â  Â  let legendary = new Set();

Â  Â  function buildGrid(r=R, c=C, givenLabels=null) {
Â  R = r;
Â  C = c;
Â  cellsEl.style.gridTemplateColumns = `repeat(${C}, minmax(50px, 1fr))`;

Â  if (givenLabels && givenLabels.length) {
Â  Â  labels = givenLabels;
Â  } else {
Â  Â  labels = Array.from({length: r*c}, (_,i)=>`å®Ÿç¸¾ ${i+1}`);
Â  }
Â Â 
Â  cellsEl.innerHTML = '';
Â  Â  let effectiveCount = 0;

 for (let i=0; i<r*c; i++) {
Â  const label = labels[i] || null;
Â  const cell = document.createElement('div');
Â  cell.className = 'cell';
Â Â 
Â  if (label === null) {
Â  Â  cellsEl.appendChild(cell);
Â  Â  continue;
Â  }

Â  effectiveCount++; // âœ… null ã§ãªã‘ã‚Œã°å¿…ãšã‚«ã‚¦ãƒ³ãƒˆï¼ˆlegendary ã‚‚å«ã‚€ï¼‰
Â Â 

Â  Â  const btn = document.createElement('button');
Â  Â  btn.type = 'button';
Â  Â  btn.dataset.idx = i;
Â  Â  btn.setAttribute('aria-pressed', 'false');
Â  Â  if (legendary.has(i)) btn.classList.add('legendary');

Â  Â  let imgSrc = "images/placeholder.png";
Â  Â  let textLabel = "";

Â  Â  if (typeof label === "object") {
Â  Â  Â  imgSrc = label.img || imgSrc;
Â  Â  Â  textLabel = label.text || "";
Â  Â  } else if (typeof label === "string") {
Â  Â  Â  if (label.match(/\.(jpg|png|gif)$/)) imgSrc = label;
Â  Â  Â  else textLabel = label;
Â  Â  }

Â  Â  btn.innerHTML =`
Â  Â  Â  <span class="badge">#${i+1}</span>
Â  Â  Â  <img src="${imgSrc}" alt="">
Â  Â  Â  <span class="cell-text">${textLabel}</span>`;

Â  Â  btn.addEventListener('click', () => toggle(btn));
Â  Â  cell.appendChild(btn);
Â  Â  cellsEl.appendChild(cell);
Â  }

Â  updateCounts();
Â  totalCountEl.textContent = effectiveCount;Â  // âœ… æœ‰åŠ¹ã‚»ãƒ«ã ã‘è¡¨ç¤º
 }

Â  Â  function toggle(btn){
Â  const idx = +btn.dataset.idx;
Â  // âœ… ç‰¹æ®Šå‡¦ç†ãŒå¿…è¦ãªãƒ—ãƒªã‚»ãƒƒãƒˆ
Â  const specialPresets = ["tenkenmin", "stargazing-specialist", "mvp", "top-adventure-explorer","syaken-A"];

Â  // æœ€å¾Œã®ãƒã‚¹ã¯ã‚¯ãƒªãƒƒã‚¯ç¦æ­¢
Â  if (specialPresets.includes(presetEl.value)) {
Â  Â  const allBtns = Array.from(cellsEl.querySelectorAll('button'))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(b => labels[b.dataset.idx] !== null)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .slice(0, -1); // æœ€å¾Œã®ãƒã‚¹ã‚’é™¤å¤–
Â  Â  const isLastBtn = btn.classList.contains('legendary');
Â  Â  if (isLastBtn) return;
Â  }
Â  const lit = btn.classList.toggle('lit');
Â  btn.setAttribute('aria-pressed', String(lit));
Â  updateCounts();
Â  save();//ã‚¯ãƒªãƒƒã‚¯ã”ã¨ã«è‡ªå‹•ä¿å­˜
 }

Â  Â  function resetAll(){
Â  cellsEl.querySelectorAll('button.lit').forEach(b=>{
Â  Â  b.classList.remove('lit');
Â  Â  b.setAttribute('aria-pressed','false');
Â  });
Â  updateCounts();
Â  save();Â  Â // âœ… ãƒªã‚»ãƒƒãƒˆã”ã¨ã«è‡ªå‹•ä¿å­˜
 }

Â  Â  function updateCounts(){
Â  // âœ… tenkenmin / specialist / explorer / syaken-A ã®ç‰¹æ®Šå‡¦ç†
Â  const specialPresets = ["tenkenmin", "stargazing-specialist", "top-adventure-explorer","syaken-A"];
Â  if (specialPresets.includes(presetEl.value)) {
Â  Â  const allButtons = cellsEl.querySelectorAll('button[data-idx]');
Â  Â  const lastBtn = Array.from(cellsEl.querySelectorAll('button'))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .filter(b => labels[b.dataset.idx] !== null)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .pop();
Â  Â  if (lastBtn) {
Â  Â  Â  const lastIdx = +lastBtn.dataset.idx; // â† ã“ã“ã§ lastIdx ã‚’å®šç¾©
Â  Â  Â  const otherBtns = Array.from(allButtons).filter(b => +b.dataset.idx !== lastIdx);
Â  Â  Â  const allLit = otherBtns.every(b => b.classList.contains('lit'));
Â  Â  Â  if (allLit) {
Â  Â  Â  Â  lastBtn.classList.add('lit');
Â  Â  Â  Â  lastBtn.setAttribute('aria-pressed','true');
Â  Â  Â  } else {
Â  Â  Â  Â  lastBtn.classList.remove('lit');
Â  Â  Â  Â  lastBtn.setAttribute('aria-pressed','false');
Â  Â  Â  }
Â  Â  }
Â  }

Â  // âœ… MVPå°‚ç”¨å‡¦ç†
Â  if (presetEl.value === "mvp") {
Â  Â  let lastIdx = labels.length - 1;
Â  Â  while (lastIdx >= 0 && labels[lastIdx] === null) lastIdx--;
Â  Â  const lastBtn = cellsEl.querySelector(`button[data-idx="${lastIdx}"]`);
Â  Â  if (lastBtn) {
Â  Â  Â  const participate = [0, 3, 6].every(i =>
Â  Â  Â  Â  cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
Â  Â  Â  );
Â  Â  Â  const champion = [1, 4, 7].some(i =>
Â  Â  Â  Â  cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
Â  Â  Â  );
Â  Â  Â  const mvp = [2, 5, 8].some(i =>
Â  Â  Â  Â  cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
Â  Â  Â  );

Â  Â  Â  if (participate && champion && mvp) {
Â  Â  Â  Â  lastBtn.classList.add('lit');
Â  Â  Â  Â  lastBtn.setAttribute('aria-pressed','true');
Â  Â  Â  } else {
Â  Â  Â  Â  lastBtn.classList.remove('lit');
Â  Â  Â  Â  lastBtn.setAttribute('aria-pressed','false');
Â  Â  Â  }
Â  Â  }
Â  }

Â  // âœ… litCount ã‚’æ­£ã—ãè¨ˆç®—
Â  const litButtons = cellsEl.querySelectorAll('button.lit');
Â  litCountEl.textContent = litButtons.length;

Â  // âœ… å ±é…¬ç²å¾—ãƒœã‚¿ãƒ³åˆ¶å¾¡
Â  const rewardBtn = document.getElementById('rewardBtn');
Â  const anyLegendaryLit = cellsEl.querySelector('button.legendary.lit') !== null;
Â  Â  Â Â 
Â  if (anyLegendaryLit) {
Â  Â  rewardBtn.style.display = "inline-block";
Â  Â  rewardBtn.disabled = false;
Â  } else {
Â  Â  rewardBtn.style.display = "none";
Â  Â  rewardBtn.disabled = true;
Â  }
Â  Â  Â  // âœ… é€²æ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼æ›´æ–°
Â  checkProgressButtons();

Â  // âœ… é€²æ—ç‡ã®è¨ˆç®—ã¨è¡¨ç¤º
Â  const totalCells = cellsEl.querySelectorAll('.cell').length - cellsEl.querySelectorAll('.cell > :not(button)').length;
Â  const percentage = totalCells > 0 ? ((litButtons.length / totalCells) * 100).toFixed(1) : 0;
Â  progressRateBtn.textContent = `${litButtons.length} / ${totalCells} è§£æ”¾ (${percentage}%)`;
Â  progressRateBtn.style.display = "inline-block";

Â  // âœ… é€²æ—ç‡å ±é…¬ãƒœã‚¿ãƒ³ã®åˆ¶å¾¡
Â  if (percentage >= 70) {
Â  Â  progressRewardBtn.style.display = "inline-block";
Â  Â  progressRewardBtn.classList.add("lit");
Â  } else {
Â  Â  progressRewardBtn.style.display = "none";
Â  Â  progressRewardBtn.classList.remove("lit");
Â  }
Â  Â  Â Â 
 }

Â  Â  // é€²æ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼æ›´æ–°
Â  Â  function checkProgressButtons() {
Â  // å„ãƒ—ãƒªã‚»ãƒƒãƒˆã”ã¨ã«ãƒã‚§ãƒƒã‚¯
Â  Object.entries(PRESETS).forEach(([key, preset]) => {
Â  Â  const btnId = {
Â  Â  Â  "tenkenmin": "pb1",
Â  Â  Â  "stargazing-specialist": "pb2",
Â  Â  Â  "mvp": "pb3",
Â  Â  Â  "top-adventure-explorer": "pb4",
Â  Â  Â  "syaken-A": "pb5",
Â  Â  }[key];

Â  Â  if (!btnId) return; // æœªå¯¾å¿œãƒ—ãƒªã‚»ãƒƒãƒˆã¯ã‚¹ã‚­ãƒƒãƒ—

Â  Â  const pb = document.getElementById(btnId);
Â  Â  if (!pb) return;

Â  Â  // ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
Â  Â  const raw = localStorage.getItem(getStorageKey(key));
Â  Â  let lit = [];
Â  Â  if (raw) {
Â  Â  Â  try {
Â  Â  Â  Â  const data = JSON.parse(raw);
Â  Â  Â  Â  if (data && Array.isArray(data.lit)) {
Â  Â  Â  Â  Â  lit = data.lit;
Â  Â  Â  Â  }
Â  Â  Â  } catch(e) {
Â  Â  Â  Â  console.error("parse failed", e);
Â  Â  Â  }
Â  Â  }

Â  Â  // ğŸ”½ labels ã®æœ«å°¾ã‹ã‚‰ null ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦æœ€å¾Œã®æœ‰åŠ¹ã‚»ãƒ«ã‚’å–å¾—
Â  Â  let lastIdx = preset.labels.length - 1;
Â  Â  while (lastIdx >= 0 && preset.labels[lastIdx] === null) {
Â  Â  Â  lastIdx--;
Â  Â  }

Â  Â  // âœ… lastIdx ã‚’ä½¿ã†ï¼ˆtotal-1 ã§ã¯ãªã„ï¼ï¼‰
Â  Â  if (lit.includes(lastIdx)) {
Â  Â  Â  pb.classList.add("lit");
Â  Â  Â  pb.setAttribute("aria-pressed","true");
Â  Â  } else {
Â  Â  Â  pb.classList.remove("lit");
Â  Â  Â  pb.setAttribute("aria-pressed","false");
Â  Â  }
Â  });
 }

Â  Â  function getStorageKey(presetName) {
Â  return `achievements-${presetName}`;
 }
Â  Â Â 
Â  Â  function save(presetName = presetEl.value) {
Â  const lit = Array.from(cellsEl.querySelectorAll('button.lit'))
Â  Â  .map(b => +b.dataset.idx);

Â  const data = { lit };

Â  // âœ… ãƒ—ãƒªã‚»ãƒƒãƒˆåã”ã¨ã«ã‚­ãƒ¼ã‚’åˆ†ã‘ã‚‹
Â  localStorage.setItem(getStorageKey(presetName), JSON.stringify(data));
 }

Â  Â  // âœ… çŠ¶æ…‹èª­ã¿è¾¼ã¿
 function load(presetName = presetEl.value) {
Â  const raw = localStorage.getItem(getStorageKey(presetName));
Â  if (!raw) return;
Â  try {
Â  Â  const data = JSON.parse(raw);
Â  Â  if (!data || !Array.isArray(data.lit)) return;

Â  Â  // ä¸€åº¦ã™ã¹ã¦æ¶ˆç¯
Â  Â  cellsEl.querySelectorAll('button').forEach(b=>{
Â  Â  Â  b.classList.remove('lit');
Â  Â  Â  b.setAttribute('aria-pressed','false');
Â  Â  });

Â  Â  // ä¿å­˜ã•ã‚Œã¦ã„ãŸã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å†ç‚¹ç¯
Â  Â  data.lit.forEach(idx=>{
Â  Â  Â  const btn = cellsEl.querySelector(`button[data-idx="${idx}"]`);
Â  Â  Â  if (btn) {
Â  Â  Â  Â  btn.classList.add('lit');
Â  Â  Â  Â  btn.setAttribute('aria-pressed','true');
Â  Â  Â  }
Â  Â  });

Â  Â  updateCounts();
Â  } catch(e) {
Â  Â  console.error("load failed", e);
Â  }
Â  // âœ… é€²æ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼æ›´æ–°
Â  Â  checkProgressButtons();
 }

Â  Â  function usePreset(name){
Â  Â  Â  const p = PRESETS[name];
Â  Â  Â  if (!p) return;
Â  Â  Â  legendary = new Set(p.legendary || []);
Â  Â  Â  buildGrid(p.size[0], p.size[1], p.labels);
Â  Â  Â  //save();
Â  Â  }
Â  Â  let currentPreset = presetEl.value;Â  // âœ… è¿½åŠ ï¼šæœ€åˆã«ç¾åœ¨ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä¿æŒ

Â  Â  presetEl.addEventListener('change', (e)=>{
Â  const newPreset = e.target.value;
Â  if (!newPreset) return;

Â  save(currentPreset);Â  Â  Â  Â  // æ—§ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä¿å­˜
Â  usePreset(newPreset);Â  Â  Â  Â // æ–°ãƒ—ãƒªã‚»ãƒƒãƒˆã«åˆ‡æ›¿
Â  load(newPreset);Â  Â  Â  Â  Â  Â  // âœ… æ–°ãƒ—ãƒªã‚»ãƒƒãƒˆã®ä¿å­˜æ¸ˆã¿çŠ¶æ…‹ã‚’èª­ã¿è¾¼ã¿
Â  currentPreset = newPreset;Â  // æ›´æ–°

Â  Â  Â  // âœ… æœ€å¾Œã«é¸æŠã—ãŸãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä¿å­˜
Â  localStorage.setItem('lastPreset', newPreset);
 });

Â  Â  resetBtn.addEventListener('click', resetAll);

Â  Â  // âœ… æœ€å¾Œã«é¸æŠã—ãŸãƒ—ãƒªã‚»ãƒƒãƒˆã‚’å–å¾—
 const lastPreset = localStorage.getItem('lastPreset');
 if (lastPreset && PRESETS[lastPreset]) {
Â  presetEl.value = lastPreset;
Â  currentPreset = lastPreset;
Â  // ãƒšãƒ¼ã‚¸åˆæœŸè¡¨ç¤ºæ™‚ã«ãƒ—ãƒªã‚»ãƒƒãƒˆã¨ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
Â  Â  usePreset(presetEl.value);
Â  Â  load();Â  Â Â 
 }
Â  Â  // âœ… ãƒ—ãƒªã‚»ãƒƒãƒˆå¤‰æ›´æ™‚
 presetEl.addEventListener('change', () => {
Â  save(presetEl.value); // â† åˆ‡ã‚Šæ›¿ãˆå‰ã®ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä¿å­˜
Â  localStorage.setItem("lastPreset", presetEl.value); // â† æœ€å¾Œã®ãƒ—ãƒªã‚»ãƒƒãƒˆè¨˜éŒ²

Â  currentPreset = presetEl.value; // â† ç¾åœ¨ã®ãƒ—ãƒªã‚»ãƒƒãƒˆæ›´æ–°
Â  legendary = new Set(PRESETS[presetEl.value].legendary || []);
Â  buildGrid(...PRESETS[presetEl.value].size, PRESETS[presetEl.value].labels);
Â  load(presetEl.value);
 });

 // âœ… ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
 window.addEventListener('DOMContentLoaded', () => {
Â  const last = localStorage.getItem("lastPreset") || "tenkenmin";
Â  presetEl.value = last;
Â  legendary = new Set(PRESETS[last].legendary || []);
Â  buildGrid(...PRESETS[last].size, PRESETS[last].labels);
Â  load(last);
 });

Â  </script>
</body>
</html>
