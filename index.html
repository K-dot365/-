<!doctype html>
<html lang="ja">
<head>
 <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2025å¤åˆå®¿ å®Ÿç¸¾è§£é™¤</title>
  <style>
    :root {
      --bg: #0e0f10;
      --panel: #15191e;
      --border: #2b3139;
      --text: #dfe7ef;
      --muted: #8d99a6;
      --btn: #1e242b;
      --btn-hover: #28313a;
      --accent: #4caf50;
      --accent-glow: #b3ffb8;
      --gold: #f4c542;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: radial-gradient(1000px 600px at 20% -10%, #1b2027, var(--bg));
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, sans-serif;
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .app { width: min(1100px, 96vw); }
    header {
      display:flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    h1 {
      font-size: clamp(18px, 2.3vw, 24px);
      margin: 0;
      letter-spacing: .02em;
    }
    .controls {
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }
    .control, button, select, input[type="number"] {
      background: var(--btn);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 12px;
      font: inherit;
      transition: transform .02s ease, background .2s ease, border-color .2s ease;
      outline: none;
    }
    button:hover, select:hover, input[type="number"]:hover { background: var(--btn-hover); }
    button:active { transform: translateY(1px); }
    .grid {
      background: linear-gradient(180deg, #13171c, var(--panel));
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      position: relative;
    }
    .cells { display: grid; gap: 12px; }
    .cell { position: relative; }
    .cell button {
      width: 100%;
      aspect-ratio: 1 / 1;
      border-radius: 14px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      background: #0f1419;
      border: 1px solid #212932;
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.03);
      min-width: 44px;
      min-height: 44px;
    }
    .cell button .label {
      position: absolute;
      left: 10px;
      bottom: 8px;
      right: 10px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.2;
    }
    .cell button .badge {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: #1b222a;
      border:1px solid #2a313a;
      color: var(--muted);
    }
    .cell button.lit {
      border-color: rgba(76, 175, 80, .7);
      box-shadow: 0 0 0 1px rgba(76, 175, 80, .7),
                  0 4px 22px 0 rgba(76, 175, 80, .25),
                  inset 0 0 18px rgba(76, 175, 80, .25);
      background: radial-gradient(120px 120px at 30% 20%, rgba(76,175,80,.20), transparent), #0f1419;
    }
    .cell button.lit img,
.cell button.lit .cell-text {
  filter: brightness(1.3) drop-shadow(0 0 10px rgba(76, 255, 80, 0.8));
  transition: filter 0.3s ease;
}

.cell button.legendary.lit {
  box-shadow: 0 0 0 1px rgba(244,197,66,.45),
              0 6px 26px 0 rgba(244,197,66,.35),
              inset 0 0 22px rgba(244,197,66,.3);
  background: radial-gradient(120px 120px at 30% 20%, rgba(244,197,66,.22), transparent), #0f1419;
}

.cell button.legendary.lit img,
.cell button.legendary.lit .cell-text {
  filter: brightness(1.3) drop-shadow(0 0 10px rgba(255, 255, 120, 0.9));
}

    .cell button.lit::after {
      content:"";
      position:absolute;
      inset:-4px;
      border-radius: 16px;
      pointer-events: none;
      box-shadow: 0 0 22px 8px rgba(179,255,184,.12);
      animation: pulse 1.6s ease-in-out infinite;
    }
    @keyframes pulse {
      0%{ opacity:.45 }
      50%{ opacity:.1 }
      100%{ opacity:.45 }
    }
    .cell button.legendary { border-color: rgba(244,197,66,.7); }
    .cell button.legendary.lit {
      box-shadow: 0 0 0 1px rgba(244,197,66,.45),
                  0 6px 26px 0 rgba(244,197,66,.35),
                  inset 0 0 22px rgba(244,197,66,.3);
      background: radial-gradient(120px 120px at 30% 20%, rgba(244,197,66,.22), transparent), #0f1419;
    }
    .footer {
      display:flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      color: var(--muted);
      font-size: 13px;
    }
    .count { font-variant-numeric: tabular-nums; }

    /* ğŸ“± ã‚¹ãƒãƒ›ç”¨èª¿æ•´ */
    @media (max-width: 600px) {
      body { padding: 12px; }
      header { flex-direction: column; align-items: flex-start; gap: 8px; }
      .controls { width: 100%; justify-content: flex-start; }
      .cell button .label { font-size: 10px; }
      .cell button .badge { font-size: 9px; padding: 2px 6px; }
      h1 { font-size: 16px; }

      /* âœ… è¿½åŠ : ã‚¿ã‚¤ãƒˆãƒ«ã¨é€²æ—ãƒœã‚¿ãƒ³ã¯æ¨ªä¸¦ã³ç¶­æŒ */
  .title-row {
    flex-direction: row;
    flex-wrap: wrap; /* ç‹­ã‘ã‚Œã°æŠ˜ã‚Šè¿”ã™ */
  }
      
    }

    .cell {
      position: relative;
      width: 100%;
      aspect-ratio: 1/1;
      overflow: hidden;
      border-radius: 8px;
    }
    .cell img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    .cell-text {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      font-weight: bold;
      text-align: center;
      padding: 4px 0;
      font-size: 12px;
    }

    .cell-text {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      font-weight: bold;
      text-align: center;
      padding: 4px 0;
      font-size: 12px;
    }

    /* å ±é…¬ç²å¾—ãƒœã‚¿ãƒ³ã®æ–‡å­—ã‚’ç™½ã«ã€é‡‘è‰²ã‚°ãƒ­ãƒ¼ */
#rewardBtn {
  position: relative;
  border: 1px solid var(--accent);
  background: var(--accent);
  color: #fff; /*ç™½æ–‡å­—*/
  font-weight: bold;
  cursor: pointer;
  overflow: hidden;
  transition: transform 0.1s ease, box-shadow 0.3s ease;
  border-radius: 12px;
  box-shadow: 0 0 6px rgba(244,197,66,0.5), 0 0 18px rgba(244,197,66,0.4);
}

#rewardBtn::before {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, rgba(255,255,255,0.3) 25%, rgba(255,255,255,0.0) 50%, rgba(255,255,255,0.3) 75%);
  transform: rotate(45deg) translateX(-100%);
  pointer-events: none;
  transition: transform 0.5s ease;
}

#rewardBtn:hover::before {
  transform: rotate(45deg) translateX(100%);
}

#rewardBtn:hover {
  box-shadow: 0 0 15px var(--accent-glow), 0 0 30px var(--accent-glow);
  transform: scale(1.05);
}
    
/* æŠ¼ã›ãªã„çŠ¶æ…‹ã§ã‚‚å…‰ã‚‰ã›ã‚‹å ´åˆ */
#rewardBtn.disabled {
  cursor: default;
  opacity: 1;
  box-shadow: 0 0 15px rgba(244,197,66,0.7), 0 0 30px rgba(244,197,66,0.6);
}

    #rewardBtn.disabled {
  cursor: default;
  opacity: 1;
  box-shadow: 0 0 15px rgba(244,197,66,0.7), 0 0 30px rgba(244,197,66,0.6);
}

/* h1 ã¨é€²æ—ãƒœã‚¿ãƒ³ã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹ */
.title-row {
  display: flex;
  align-items: center;
  gap: 12px; /* h1 ã¨ãƒœã‚¿ãƒ³ã®é–“ã®ä½™ç™½ */
}

/* é€²æ—ãƒœã‚¿ãƒ³ç¾¤ */
.progress-btns {
  display: flex;
  gap: 6px;
}

.progress-btns button {
  width: 32px;
  height: 32px;
  border-radius: 8px;
  background: #222;
  border: 1px solid #444;
  color: #aaa;
  font-weight: bold;
  pointer-events: none; /* æŠ¼ã›ãªã„ */
}

.progress-btns button.lit {
  background: #0f1419;
  border-color: rgba(76, 175, 80, .7);
  color: #fff;
  box-shadow: 0 0 0 1px rgba(76, 175, 80, .35),
              0 4px 12px rgba(76, 175, 80, .4),
              inset 0 0 18px rgba(76, 175, 80, .25);
}

/* âœ… æ–°è¨­: é’è‰²ã®å ±é…¬ç²å¾—ãƒœã‚¿ãƒ³ */
#rewardBtnBlue {
    position: relative;
    border: 1px solid #42a5f5; /* é’è‰² */
    background: #42a5f5; /* é’è‰² */
    color: #fff;
    font-weight: bold;
    cursor: default; /* ã‚¯ãƒªãƒƒã‚¯ä¸å¯ */
    overflow: hidden;
    border-radius: 12px;
    opacity: 1;
    /* é’è‰²ã®ã‚°ãƒ­ãƒ¼åŠ¹æœ */
    box-shadow: 0 0 15px rgba(66, 165, 245, 0.7), 0 0 30px rgba(66, 165, 245, 0.6);
}

  </style>
</head>
<body>
<div class="app">
    <header>
      <div class="title-row">
        <h1>2025å¤åˆå®¿ å®Ÿç¸¾è§£é™¤</h1>
        <button id="totalProgressDisplay" class="control" style="pointer-events: none;"></button>
    </div>
      <div class="controls">
        <select id="preset">
          <option value="tenkenmin">å¤©ç ”æ°‘ã¨ã®äº¤æµ</option>
          <option value="stargazing-specialist">è¦³æ¸¬ã®ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆ</option>
          <option value="mvp">ï¼­ï¼¶ï¼°(ã‚‚ã£ã¨ã‚‚ ãƒ´ã‚¡ã‚’ç››ã‚Šä¸Šã’ãŸ ã±ãƒ¼ãã‚“)</option>
          <option value="top-adventure-explorer">ä¸€æµå†’é™ºå®¶</option>
          <option value="syaken-A">å†™ç ”ã®ã‚¨ãƒ¼ã‚¹</option>
        </select>
        <button id="reset">ã™ã¹ã¦æ¶ˆç¯</button>
        <div id="progressBtns" class="progress-btns">
    <button id="pb1" disabled>1</button>
    <button id="pb2" disabled>2</button>
    <button id="pb3" disabled>3</button>
    <button id="pb4" disabled>4</button>
    <button id="pb5" disabled>5</button>
      </div>
        <button id="rewardBtn" style="display:none;" disabled>å ±é…¬ç²å¾—ï¼</button>
        <button id="rewardBtnBlue" style="display:none;" disabled>å ±é…¬ç²å¾—ï¼</button>
      </div>
    </header>

    <section class="grid">
      <div id="cells" class="cells"></div>
      <div class="footer">
        <div class="count"><span id="litCount">0</span> / <span id="totalCount">0</span> è§£æ”¾</div>
        <div class="hint">ã‚»ãƒ«ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ç‚¹ç¯/æ¶ˆç¯</div>
      </div>
    </section>
  </div>

  <script>
    const cellsEl = document.getElementById('cells');
    const resetBtn = document.getElementById('reset');
    const presetEl = document.getElementById('preset');
    const litCountEl = document.getElementById('litCount');
    const totalCountEl = document.getElementById('totalCount');

    // âœ… å¤‰æ›´: ãƒ—ãƒªã‚»ãƒƒãƒˆå†…å®¹ã‚’æ›´æ–°
    const PRESETS = {
      "tenkenmin": {
        size:[17,3],
        labels:[
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"3.ã‘ã„ãŸ<br>(ä¼šé•·)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"3.ã—ã‚‡ãƒ¼ãŸã‚ãƒ¼<br>(ç·è¦³)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"3.ã‹ã»<br>(å‰¯ä¼šé•·)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"3.ã’ã‚“<br>(ä¼šé•·è£œä½)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"3.ã¾ã©ã‹<br>(ä¼šè¨ˆ)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"3.ã‚†ã<br>(å‰¯ç·è¦³)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"3.ãªã<br>(å†™ç ”ç­é•·"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"3.ã˜ã‚Š<br>(å†™ç ”å‰¯ç­é•·)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"3.ã¤ã‚ˆã—<br>(ãƒ—ãƒ©ãƒç­é•·)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"3.ã¦ã‚‹ã‚„<br>(å†™ç ”3ç•ªæ‰‹)"},//10
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"3.ã‘ã‚ã‚“"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//20
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//30
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//40
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//45
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"ã‘ãŸ"},//50
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ex001.jpg",text:"å…¨å“¡é”æˆ"},
        ],
        legendary:[50]
      },
      "stargazing-specialist": {
        size:[9,3],
        labels:[
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st001.jpg",text:"æœ›é é¡çµ„ã¿ç«‹ã¦ã«æºã‚ã‚‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st002.jpg",text:"ç·è¦³ã•ã‚“ã‚’å¤§ããªå£°ã§å‘¼ã¶"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st003.jpg",text:"ã‚¦ã‚©ãƒƒãƒãƒ³ã‚°ã‚’é–‹ã"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st004.jpg",text:"åŒå®šã‚’ãŠé¡˜ã„ã™ã‚‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st005.jpg",text:"ä¸€æ™©ä¸­èµ·ãã¦ãŠã"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st006.jpg",text:"M103(ã‚«ã‚·ã‚ªãƒšã‚¢)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st007.jpg",text:"M110(ã‚¢ãƒ³ãƒ‰ãƒ­ãƒ¡ãƒ€)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st008.jpg",text:"M15(ãºã‚¬ã‚¹ã‚¹)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st009.jpg",text:"M34(ãƒšãƒ«ã‚»ã‚¦ã‚¹)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st010.jpg",text:"M33(ã•ã‚“ã‹ã)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st011.jpg",text:"M36(ãã‚‡ã—ã‚ƒ)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st012.jpg",text:"M37(ãã‚‡ã—ã‚ƒ)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st013.jpg",text:"M38(ãã‚‡ã—ã‚ƒ)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st014.jpg",text:"M45(ãŠã†ã—)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st015.jpg",text:"M71(ã‚„)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st016.jpg",text:"M2(ã¿ãšãŒã‚)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st017.jpg",text:"M30(ã‚„ã)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st018.jpg",text:"M27(ã“ãã¤ã­)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st019.jpg",text:"M29(ã¯ãã¡ã‚‡ã†)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st020.jpg",text:"M57(ã“ã¨)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st021.jpg",text:"M35(ãµãŸã”)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st022.jpg",text:"M42(ã‚ªãƒªã‚ªãƒ³)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st023.jpg",text:"M44(ã‹ã«)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st024.jpg",text:"M79(ã†ã•ã)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st025.jpg",text:"M41(ãŠãŠã„ã¬)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/st026.jpg",text:"å®Ÿç¸¾é”æˆ"},
         null,
        ],
        legendary:[25]
      },
      "mvp": {
        size:[4,3],
        labels:[
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv001.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯å‚åŠ "},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv002.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯å„ªå‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv003.jpg",text:"ãƒã‚¹ãƒ¬ã‚¯MVP"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv004.jpg",text:"é‹å‹•å‚åŠ "},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv005.jpg",text:"é‹å‹•å„ªå‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv006.jpg",text:"é‹å‹•MVP"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv007.jpg",text:"ã‚¯ã‚¤ã‚ºå‚åŠ "},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv008.jpg",text:"ã‚¯ã‚¤ã‚ºå„ªå‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv009.jpg",text:"ã‚¯ã‚¤ã‚ºMVP"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/mv010.jpg",text:"å®Ÿç¸¾é”æˆ"},
          null,
          null,
        ],
        legendary:[9]
      },
      "top-adventure-explorer": {
        size:[4,3],
        labels:[
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad001.jpg",text:"ãŠå¯ºå‚æ‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad002.jpg",text:"å¤§ç¥å±±ç¥ç¤¾å‚æ‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad003.jpg",text:"ã‚¹ã‚­ãƒ¼ã‚¸ãƒ£ãƒ³ãƒ—å°"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad004.jpg",text:"ã‚²ãƒ¬ãƒ³ãƒ‡ãƒªãƒ•ãƒˆä¹—ã‚Šå ´"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad005.jpg",text:"ãƒ¢ãƒ³ãƒ™ãƒ«å¤§å±±åº—"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad006.jpg",text:"å¤§å±±è‡ªç„¶é¤¨"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad007.jpg",text:"è¶³æ¹¯"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad008.jpg",text:"é³¥å–ç ‚ä¸˜ã®æµ·"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad009.jpg",text:"é³¥å–ç ‚ä¸˜ã®é¦¬ã®èƒŒ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad010.jpg",text:"é³¥å–ç ‚ä¸˜ãƒ¢ãƒ‹ãƒ¥ãƒ¡ãƒ³ãƒˆ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/ad011.jpg",text:"å®Ÿç¸¾é”æˆ"},
          null,
        ],
        legendary:[10]
      },
      "syaken-A": {
        size:[5,3],
        labels:[
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy001.jpg",text:"ğŸ“¸æ˜Ÿç©ºå†™çœŸ(å¤©ã®å·ä»¥å¤–)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy002.jpg",text:"ğŸ“¸æ˜Ÿç©ºå†™çœŸ(å¤©ã®å·)"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy003.jpg",text:"ğŸ“¸éŠ€æ²³"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy004.jpg",text:"ğŸ“¸æ˜Ÿé›²"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy005.jpg",text:"ğŸ“¸æ˜Ÿå›£"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy006.jpg",text:"å¤œã®éƒ¨æŠ•ç¥¨ç”¨å†™çœŸ"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy007.jpg",text:"é‹å‹•ä¼š"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy008.jpg",text:"é£Ÿäº‹"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy009.jpg",text:"èŠ±ç«"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy010.jpg",text:"å®¿ã§ã®éŠã³é¢¨æ™¯"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy011.jpg",text:"æ˜¼ã®éƒ¨æŠ•ç¥¨æ•°1ä½"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy012.jpg",text:"å¤œã®éƒ¨æŠ•ç¥¨æ•°1ä½"},
          {img:"å®Ÿç¸¾è§£é™¤ç”»åƒ/sy013.jpg",text:"å…¨ãŠé¡Œé”æˆ"},
          null,
          null,
        ],
        legendary:[10, 11, 12]
      },
    };
    
    let R = 4, C = 5;
    let labels = [];
    let legendary = new Set();

    function buildGrid(r=R, c=C, givenLabels=null) {
      R = r;
      C = c;
      cellsEl.style.gridTemplateColumns = `repeat(${C}, minmax(50px, 1fr))`;

      if (givenLabels && givenLabels.length) {
        labels = givenLabels;
      } else {
        labels = Array.from({length: r*c}, (_,i)=>`å®Ÿç¸¾ ${i+1}`);
      }
      
      cellsEl.innerHTML = '';
      let effectiveCount = 0;

      for (let i=0; i<r*c; i++) {
        const label = labels[i] || null;
        const cell = document.createElement('div');
        cell.className = 'cell';
        
        if (label === null) {
          cellsEl.appendChild(cell);
          continue;
        }

        effectiveCount++;
        
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.dataset.idx = i;
        btn.setAttribute('aria-pressed', 'false');
        if (legendary.has(i)) btn.classList.add('legendary');

        let imgSrc = "images/placeholder.png";
        let textLabel = "";

        if (typeof label === "object") {
          imgSrc = label.img || imgSrc;
          textLabel = label.text || "";
        } else if (typeof label === "string") {
          if (label.match(/\.(jpg|png|gif)$/)) imgSrc = label;
          else textLabel = label;
        }

        btn.innerHTML =`
          <span class="badge">#${i+1}</span>
          <img src="${imgSrc}" alt="">
          <span class="cell-text">${textLabel}</span>`;

        btn.addEventListener('click', () => toggle(btn));
        cell.appendChild(btn);
        cellsEl.appendChild(cell);
      }

      updateCounts();
      totalCountEl.textContent = effectiveCount;
    }

    // âœ… å¤‰æ›´: è‡ªå‹•ç‚¹ç¯ãƒã‚¹ã®ã‚¯ãƒªãƒƒã‚¯åˆ¶å¾¡ã‚’æ›´æ–°
    function toggle(btn){
        const idx = +btn.dataset.idx;

        // è‡ªå‹•ç‚¹ç¯ã™ã‚‹ã‚»ãƒ«ã¯ã‚¯ãƒªãƒƒã‚¯ã•ã›ãªã„
        if (presetEl.value === 'syaken-A' && idx === 12) return;
        if (presetEl.value === 'stargazing-specialist' && idx === 25) return;
        
        const preset = PRESETS[presetEl.value];
        if (preset) {
            const autoLitPresets = ["tenkenmin", "mvp", "top-adventure-explorer"];
            if (autoLitPresets.includes(presetEl.value)) {
                let lastIdx = preset.labels.length - 1;
                while (lastIdx >= 0 && preset.labels[lastIdx] === null) {
                    lastIdx--;
                }
                if (idx === lastIdx) return;
            }
        }

        const lit = btn.classList.toggle('lit');
        btn.setAttribute('aria-pressed', String(lit));
        updateCounts();
        save();
    }

    function resetAll(){
      cellsEl.querySelectorAll('button.lit').forEach(b=>{
        b.classList.remove('lit');
        b.setAttribute('aria-pressed','false');
      });
      updateCounts();
      save();
    }
    
    // âœ… å¤‰æ›´: å„ãƒ—ãƒªã‚»ãƒƒãƒˆã®å°‚ç”¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ãƒ»æ›´æ–°
    function updateCounts(){
      // tenkenmin / explorer ã®ç‰¹æ®Šå‡¦ç†
      const simpleAllLitPresets = ["tenkenmin", "top-adventure-explorer"];
      if (simpleAllLitPresets.includes(presetEl.value)) {
        const allButtons = cellsEl.querySelectorAll('button[data-idx]');
        const lastBtn = Array.from(cellsEl.querySelectorAll('button'))
                            .filter(b => labels[b.dataset.idx] !== null)
                            .pop();
        if (lastBtn) {
          const lastIdx = +lastBtn.dataset.idx;
          const otherBtns = Array.from(allButtons).filter(b => +b.dataset.idx !== lastIdx);
          const allLit = otherBtns.every(b => b.classList.contains('lit'));
          if (allLit) {
            lastBtn.classList.add('lit');
            lastBtn.setAttribute('aria-pressed','true');
          } else {
            lastBtn.classList.remove('lit');
            lastBtn.setAttribute('aria-pressed','false');
          }
        }
      }

      // stargazing-specialist å°‚ç”¨å‡¦ç†
      if (presetEl.value === "stargazing-specialist") {
          const lastBtn = cellsEl.querySelector('button[data-idx="25"]');
          if (lastBtn) {
              const first5_indices = [0, 1, 2, 3, 4];
              const next_indices = Array.from({length: 20}, (_, i) => i + 5); // #6-25 (indices 5-24)

              const first5_lit = first5_indices.every(i => 
                  cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
              );
              const next_lit_count = next_indices.filter(i => 
                  cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
              ).length;
              
              if (first5_lit && next_lit_count >= 15) {
                  lastBtn.classList.add('lit');
                  lastBtn.setAttribute('aria-pressed','true');
              } else {
                  lastBtn.classList.remove('lit');
                  lastBtn.setAttribute('aria-pressed','false');
              }
          }
      }

      // syaken-A å°‚ç”¨å‡¦ç†
      if (presetEl.value === "syaken-A") {
          const allCompleteBtn = cellsEl.querySelector('button[data-idx="12"]');
          if (allCompleteBtn) {
              const normal_indices = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];
              const allNormalLit = normal_indices.every(i => 
                  cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
              );
              if (allNormalLit) {
                  allCompleteBtn.classList.add('lit');
                  allCompleteBtn.setAttribute('aria-pressed','true');
              } else {
                  allCompleteBtn.classList.remove('lit');
                  allCompleteBtn.setAttribute('aria-pressed','false');
              }
          }
      }
      
      // MVPå°‚ç”¨å‡¦ç†
      if (presetEl.value === "mvp") {
        let lastIdx = labels.length - 1;
        while (lastIdx >= 0 && labels[lastIdx] === null) lastIdx--;
        const lastBtn = cellsEl.querySelector(`button[data-idx="${lastIdx}"]`);
        if (lastBtn) {
          const participate = [0, 3, 6].every(i =>
            cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
          );
          const champion = [1, 4, 7].some(i =>
            cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
          );
          const mvp = [2, 5, 8].some(i =>
            cellsEl.querySelector(`button[data-idx="${i}"]`)?.classList.contains('lit')
          );

          if (participate && champion && mvp) {
            lastBtn.classList.add('lit');
            lastBtn.setAttribute('aria-pressed','true');
          } else {
            lastBtn.classList.remove('lit');
            lastBtn.setAttribute('aria-pressed','false');
          }
        }
      }

      const litButtons = cellsEl.querySelectorAll('button.lit');
      litCountEl.textContent = litButtons.length;

      const rewardBtn = document.getElementById('rewardBtn');
      const anyLegendaryLit = cellsEl.querySelector('button.legendary.lit') !== null;
          
      if (anyLegendaryLit) {
        rewardBtn.style.display = "inline-block";
        rewardBtn.disabled = false;
      } else {
        rewardBtn.style.display = "none";
        rewardBtn.disabled = true;
      }
      
      checkProgressButtons();
      updateTotalProgress();
    }
    
    // âœ… å¤‰æ›´: syaken-A ã®é€²æ—ãƒœã‚¿ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ›´æ–°
    function checkProgressButtons() {
        Object.entries(PRESETS).forEach(([key, preset]) => {
            const btnId = {
                "tenkenmin": "pb1",
                "stargazing-specialist": "pb2",
                "mvp": "pb3",
                "top-adventure-explorer": "pb4",
                "syaken-A": "pb5",
            }[key];

            if (!btnId) return;
            const pb = document.getElementById(btnId);
            if (!pb) return;

            let isLegendaryLit = false;

            if (key === 'syaken-A') {
                const winnerIndices = [10, 11, 12]; 
                if (key === presetEl.value) {
                    isLegendaryLit = winnerIndices.some(idx =>
                        cellsEl.querySelector(`button[data-idx="${idx}"]`)?.classList.contains('lit')
                    );
                } else { 
                    const raw = localStorage.getItem(getStorageKey(key));
                    if (raw) {
                        try {
                            const data = JSON.parse(raw);
                            if (data && Array.isArray(data.lit)) {
                                isLegendaryLit = winnerIndices.some(idx => data.lit.includes(idx));
                            }
                        } catch (e) { console.error("parse failed", e); }
                    }
                }
            } else {
                let legendaryIdx = -1;
                if(preset.legendary && preset.legendary.length > 0) {
                    legendaryIdx = preset.legendary[0];
                } else {
                    let lastIdx = preset.labels.length - 1;
                    while (lastIdx >= 0 && preset.labels[lastIdx] === null) {
                        lastIdx--;
                    }
                    legendaryIdx = lastIdx;
                }
                if (legendaryIdx === -1) return;

                if (key === presetEl.value) {
                    const legendaryBtn = cellsEl.querySelector(`button[data-idx="${legendaryIdx}"]`);
                    if (legendaryBtn && legendaryBtn.classList.contains('lit')) {
                        isLegendaryLit = true;
                    }
                } else {
                    const raw = localStorage.getItem(getStorageKey(key));
                    if (raw) {
                        try {
                            const data = JSON.parse(raw);
                            if (data && Array.isArray(data.lit) && data.lit.includes(legendaryIdx)) {
                                isLegendaryLit = true;
                            }
                        } catch (e) {
                            console.error("parse failed", e);
                        }
                    }
                }
            }

            if (isLegendaryLit) {
                pb.classList.add("lit");
                pb.setAttribute("aria-pressed", "true");
            } else {
                pb.classList.remove("lit");
                pb.setAttribute("aria-pressed", "false");
            }
        });
    }
    
    function updateTotalProgress() {
        const totalProgressDisplay = document.getElementById('totalProgressDisplay');
        const rewardBtnBlue = document.getElementById('rewardBtnBlue');

        let totalLitCount = 0;
        let totalEffectiveCellCount = 0;

        Object.entries(PRESETS).forEach(([key, preset]) => {
            const presetEffectiveCells = preset.labels.filter(l => l !== null).length;
            totalEffectiveCellCount += presetEffectiveCells;

            if (key === presetEl.value) {
                totalLitCount += cellsEl.querySelectorAll('button.lit').length;
            } else {
                const raw = localStorage.getItem(getStorageKey(key));
                if (raw) {
                    try {
                        const data = JSON.parse(raw);
                        if (data && data.lit) {
                            totalLitCount += data.lit.length;
                        }
                    } catch (e) {
                        console.error("Failed to parse stored data for", key, e);
                    }
                }
            }
        });

        const percentage = totalEffectiveCellCount > 0 ? (totalLitCount / totalEffectiveCellCount) * 100 : 0;

        totalProgressDisplay.textContent = `${totalLitCount}/${totalEffectiveCellCount} è§£æ”¾ (${percentage.toFixed(1)}%)`;

        if (percentage >= 70) {
            rewardBtnBlue.style.display = 'inline-block';
        } else {
            rewardBtnBlue.style.display = 'none';
        }
    }

    function getStorageKey(presetName) {
      return `achievements-${presetName}`;
    }
    
    function save(presetName = presetEl.value) {
      const lit = Array.from(cellsEl.querySelectorAll('button.lit'))
        .map(b => +b.dataset.idx);

      const data = { lit };
      localStorage.setItem(getStorageKey(presetName), JSON.stringify(data));
    }

    function load(presetName = presetEl.value) {
      const raw = localStorage.getItem(getStorageKey(presetName));
      if (!raw) {
        updateCounts(); // ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒãªãã¦ã‚‚åˆå›æç”»ã®ãŸã‚ã«å‘¼ã¶
        return;
      }
      try {
        const data = JSON.parse(raw);
        if (!data || !Array.isArray(data.lit)) {
            updateCounts();
            return;
        }

        cellsEl.querySelectorAll('button').forEach(b=>{
          b.classList.remove('lit');
          b.setAttribute('aria-pressed','false');
        });

        data.lit.forEach(idx=>{
          const btn = cellsEl.querySelector(`button[data-idx="${idx}"]`);
          if (btn) {
            btn.classList.add('lit');
            btn.setAttribute('aria-pressed','true');
          }
        });

        updateCounts();
      } catch(e) {
        console.error("load failed", e);
        updateCounts();
      }
      checkProgressButtons();
    }

    function usePreset(name){
      const p = PRESETS[name];
      if (!p) return;
      legendary = new Set(p.legendary || []);
      buildGrid(p.size[0], p.size[1], p.labels);
    }

    let currentPreset = presetEl.value;

    presetEl.addEventListener('change', (e)=>{
      const newPreset = e.target.value;
      if (!newPreset) return;

      save(currentPreset);
      usePreset(newPreset);
      load(newPreset);
      currentPreset = newPreset;
      localStorage.setItem('lastPreset', newPreset);
    });

    resetBtn.addEventListener('click', resetAll);

    window.addEventListener('DOMContentLoaded', () => {
      const last = localStorage.getItem("lastPreset") || "tenkenmin";
      presetEl.value = last;
      currentPreset = last;
      usePreset(last);
      load(last);
    });
  </script>
</body>
</html>
